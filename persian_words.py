# Persian Words Dictionary
# A collection of common Persian words for the Kalame game

# Common Persian words (3+ letters)
PERSIAN_WORDS = {
    # 3-letter words
    'ุขุจ', 'ุขู', 'ุงู', 'ูู', 'ุชู', 'ุงู', 'ูุง', 'ุดูุง', 'ุขููุง',
    'ฺฉุงุฑ', 'ุฎุงูู', 'ุฑุงู', 'ุฑูุฒ', 'ุดุจ', 'ุตุจุญ', 'ุนุตุฑ', 'ุธูุฑ',
    'ุฏุณุช', 'ูพุง', 'ุณุฑ', 'ฺุดู', 'ุฏู', 'ุฌุงู', 'ุฎูู', 'ูู',
    'ูุงู', 'ุขุจ', 'ุดุฑ', 'ฺฏูุดุช', 'ุจุฑูุฌ', 'ููฺฉ', 'ููุฏ', 'ฺุง',
    'ฺฉุชุงุจ', 'ููู', 'ฺฉุงุบุฐ', 'ูุฒ', 'ุตูุฏู', 'ุฏุฑุจ', 'ูพูุฌุฑู', 'ุฏูุงุฑ',
    'ุขุณูุงู', 'ุฒูู', 'ุฎูุฑุดุฏ', 'ูุงู', 'ุณุชุงุฑู', 'ุงุจุฑ', 'ุจุงุฏ', 'ุจุงุฑุงู',
    'ุฏุฑุฎุช', 'ฺฏู', 'ุจุฑฺฏ', 'ููู', 'ุณุจ', 'ูพุฑุชูุงู', 'ููุฒ', 'ุงูฺฏูุฑ',
    'ุณฺฏ', 'ฺฏุฑุจู', 'ุงุณุจ', 'ฺฏุงู', 'ูพุฑูุฏู', 'ูุงู', 'ูุงุฑ', 'ุดุฑ',
    
    # 4-letter words
    'ุงูุณุงู', 'ูุฑุฏู', 'ุฒูุฏฺฏ', 'ุฏูุง', 'ุฌูุงู', 'ฺฉุดูุฑ', 'ุดูุฑ', 'ุฑูุณุชุง',
    'ูุฏุฑุณู', 'ุฏุงูุดฺฏุงู', 'ุจูุงุฑุณุชุงู', 'ูุบุงุฒู', 'ุฑุณุชูุฑุงู', 'ูุชู', 'ูพุงุฑฺฉ', 'ุจุงุบ',
    'ุฎุงููุงุฏู', 'ูพุฏุฑ', 'ูุงุฏุฑ', 'ุจุฑุงุฏุฑ', 'ุฎูุงูุฑ', 'ูพุณุฑ', 'ุฏุฎุชุฑ', 'ูุฑุฒูุฏ',
    'ุฏูุณุช', 'ููุณุงู', 'ุงุณุชุงุฏ', 'ุฏุงูุดุฌู', 'ุฏฺฉุชุฑ', 'ูพุฒุดฺฉ', 'ูููุฏุณ', 'ูุนูู',
    'ูุงุดู', 'ุงุชูุจูุณ', 'ูุทุงุฑ', 'ููุงูพูุง', 'ุฏูฺุฑุฎู', 'ููุชูุฑ', 'ฺฉุดุช', 'ุชุงฺฉุณ',
    'ุบุฐุง', 'ุตุจุญุงูู', 'ูุงูุงุฑ', 'ุดุงู', 'ููู', 'ุณุจุฒุฌุงุช', 'ฺฏูุดุช', 'ูุฑุบ',
    'ูุจุงุณ', 'ฺฉูุด', 'ฺฉูุงู', 'ุนูฺฉ', 'ุณุงุนุช', 'ุงูฺฏุดุชุฑ', 'ฺฏุฑุฏูุจูุฏ', 'ุฏุณุชุจูุฏ',
    'ููุณู', 'ุขููฺฏ', 'ููู', 'ุชุฆุงุชุฑ', 'ููุงุด', 'ฺฉูุณุฑุช', 'ุฑูุต', 'ุจุงุฒ',
    
    # 5-letter words
    'ฺฉุงููพูุชุฑ', 'ุชููู', 'ุชููุฒูู', 'ุฑุงุฏู', 'ุงูุชุฑูุช', 'ุงูู', 'ูุจุณุงุช', 'ุจุฑูุงูู',
    'ูุฑุฒุด', 'ููุชุจุงู', 'ูุงูุจุงู', 'ุจุณฺฉุชุจุงู', 'ุชูุณ', 'ุดูุง', 'ุฏูุฏู', 'ูพุงุฏูโุฑู',
    'ฺฉุชุงุจุฎุงูู', 'ููุฒู', 'ุชุฆุงุชุฑ', 'ุณููุง', 'ุจุงุดฺฏุงู', 'ุงุณุชุฎุฑ', 'ุฒููโุจุงุฒ', 'ุณุงูู',
    'ููุฑููุฏ', 'ููุณูุฏู', 'ุดุงุนุฑ', 'ุฎูุงููุฏู', 'ุจุงุฒฺฏุฑ', 'ฺฉุงุฑฺฏุฑุฏุงู', 'ููุงุด', 'ุนฺฉุงุณ',
    'ุชุงุฑุฎ', 'ุฌุบุฑุงูุง', 'ุฑุงุถ', 'ูุฒฺฉ', 'ุดู', 'ุฒุณุชโุดูุงุณ', 'ุงุฏุจุงุช', 'ุฒุจุงู',
    'ุณูุงูุช', 'ุจูุงุฑ', 'ุฏุฑูุงู', 'ุฏุงุฑู', 'ุนูู', 'ุขุฒูุงุด', 'ูุนุงูู', 'ูุฒุช',
    'ุงูุชุตุงุฏ', 'ุณุงุณุช', 'ูุฑููฺฏ', 'ูุฐูุจ', 'ุงุฌุชูุงุน', 'ูุญุทโุฒุณุช', 'ุทุจุนุช', 'ุขููุฏฺฏ',
    
    # 6+ letter words
    'ุฏุงูุดููุฏ', 'ูููุฏุณ', 'ูพุฒุดฺฉ', 'ูุนูุงุฑ', 'ุญุณุงุจุฏุงุฑ', 'ูุฏุฑุช', 'ุงูุชุตุงุฏ', 'ุญููู',
    'ุชฺฉููููฺ', 'ุงุทูุงุนุงุช', 'ุงุฑุชุจุงุทุงุช', 'ูุฎุงุจุฑุงุช', 'ุตูุนุช', 'ฺฉุดุงูุฑุฒ', 'ุชุฌุงุฑุช', 'ุจุงุฒุฑฺฏุงู',
    'ูุฑููฺฏุณุชุงู', 'ุฏุงูุดฺฏุงู', 'ุขููุฒุดฺฏุงู', 'ูพฺููุดฺฏุงู', 'ุขุฒูุงุดฺฏุงู', 'ฺฉุชุงุจุฎุงูู', 'ฺฉุงุฑุฎุงูู', 'ุงุฏุงุฑู',
    'ุฌูููุฑ', 'ุฏููฺฉุฑุงุณ', 'ุขุฒุงุฏ', 'ุนุฏุงูุช', 'ุจุฑุงุจุฑ', 'ุญูููโุจุดุฑ', 'ุตูุญ', 'ุงููุช',
    'ูุญุทโุฒุณุช', 'ฺฏุฑูุงุด', 'ุขููุฏฺฏ', 'ุทุจุนุช', 'ุญูุงูุงุช', 'ฺฏุงูุงู', 'ุฌูฺฏู', 'ุจุงุจุงู',
}

def get_persian_words():
    """Return set of Persian words"""
    return PERSIAN_WORDS

def filter_words_by_letters(available_letters, min_length=3, allow_repetition=True):
    """
    Filter Persian words that can be made from available letters
    
    Args:
        available_letters: List of available letters
        min_length: Minimum word length (default 3)
        allow_repetition: Whether letters can be repeated (default True)
    
    Returns:
        List of valid Persian words that can be made from available letters
    """
    valid_words = []
    available_letters_lower = [letter.lower() for letter in available_letters]
    
    for word in PERSIAN_WORDS:
        if len(word) < min_length:
            continue
            
        word_lower = word.lower()
        can_make_word = True
        
        if allow_repetition:
            # Check if all letters in word are available (can repeat)
            for letter in word_lower:
                if letter not in available_letters_lower:
                    can_make_word = False
                    break
        else:
            # Check if we have enough of each letter (no repetition)
            word_letter_count = {}
            for letter in word_lower:
                word_letter_count[letter] = word_letter_count.get(letter, 0) + 1
            
            available_letter_count = {}
            for letter in available_letters_lower:
                available_letter_count[letter] = available_letter_count.get(letter, 0) + 1
            
            for letter, needed_count in word_letter_count.items():
                if letter not in available_letter_count or available_letter_count[letter] < needed_count:
                    can_make_word = False
                    break
        
        if can_make_word:
            valid_words.append(word)
    
    # Sort by length (shorter words first for faster discovery)
    valid_words.sort(key=len)
    return valid_words

def validate_word_with_vajeyab(word, mock_mode=False):
    """
    Validate a single word using vajehyab.com
    
    Args:
        word: The Persian word to validate
        mock_mode: If True, use mock validation for testing (when vajehyab.com is unavailable)
    
    Returns:
        True if the word is valid according to vajehyab.com, False otherwise
    """
    import requests
    import urllib.parse
    import time
    
    # Mock mode for testing when vajehyab.com is not accessible
    if mock_mode:
        # Mock some common Persian words as valid
        common_words = {
            'ุณูุงู', 'ฺฉุชุงุจ', 'ูุฒุฏฺฉ', 'ุฏุฑุจ', 'ุงุจุฑ', 'ุจุงุฏ', 'ุฏุณุช', 'ูุงู', 
            'ุงุณุจ', 'ุจุฑุงุฏุฑ', 'ุงูุณุงู', 'ุงุณุชุงุฏ', 'ุจุงุฑุงู', 'ุฏุณุชุจูุฏ'
        }
        is_valid = word in common_words
        print(f"๐งช Mock validation for '{word}': {'โ Valid' if is_valid else 'โ Invalid'}")
        return is_valid
    
    try:
        # URL encode the Persian word
        encoded_word = urllib.parse.quote(word)
        url = f'https://vajehyab.com/?q={encoded_word}'
        
        # Make request with timeout
        response = requests.get(url, timeout=5)
        
        if response.status_code == 200:
            # Check for indicators that the word is valid
            # Look for common Persian dictionary indicators
            content = response.text.lower()
            
            # These are common indicators that a word definition was found
            valid_indicators = [
                'ูุนู',  # meaning
                'ุชุนุฑู',  # definition  
                'ฺฉููู',   # word
                'ูุงฺู',   # vocabulary
                'ุงุณู',    # noun
                'ูุนู',    # verb
                'ุตูุช',    # adjective
                'definition',
                'meaning'
            ]
            
            # Check if any valid indicators are present
            for indicator in valid_indicators:
                if indicator in content:
                    print(f"โ Valid word found on vajehyab: {word}")
                    return True
            
            # If no indicators found, likely not a valid word
            print(f"โ Invalid word on vajehyab: {word}")
            return False
        else:
            print(f"โ๏ธ vajehyab.com returned status {response.status_code} for word: {word}")
            return False
            
    except Exception as e:
        print(f"โ๏ธ Error validating word '{word}' with vajehyab.com: {e}")
        return False

def get_vajeyab_words(letters, max_candidates=100, mock_mode=False):
    """
    Get words from Vajeyab website by generating candidates and validating them
    
    Args:
        letters: Available letters
        max_candidates: Maximum number of candidates to test (to avoid too many API calls)
        mock_mode: If True, use mock validation for testing
    
    Returns:
        List of valid words from Vajeyab
    """
    from itertools import product
    import time
    
    print(f"๐ Generating candidates from letters {letters} and validating with vajehyab.com...")
    if mock_mode:
        print("๐งช Using mock mode for testing")
        
    valid_words = []
    candidates_tested = 0
    
    # Generate candidates of different lengths (3-6 letters for efficiency)
    for length in range(3, min(7, len(letters) + 1)):
        if candidates_tested >= max_candidates:
            break
            
        print(f"๐ Testing {length}-letter combinations...")
        
        # Generate combinations with repetition allowed
        for combo in product(letters, repeat=length):
            if candidates_tested >= max_candidates:
                break
                
            word = "".join(combo)
            candidates_tested += 1
            
            print(f"[{candidates_tested}/{max_candidates}] Testing: {word}")
            
            # Validate with vajehyab.com (or mock)
            if validate_word_with_vajeyab(word, mock_mode=mock_mode):
                valid_words.append(word)
                print(f"โ Added valid word: {word}")
            
            # Small delay to be respectful to the server (only in real mode)
            if not mock_mode:
                time.sleep(0.1)
    
    print(f"๐ฏ Found {len(valid_words)} valid words from vajehyab.com out of {candidates_tested} candidates tested")
    return valid_words

if __name__ == "__main__":
    # Test the functions
    test_letters = ['ุง', 'ุจ', 'ุฑ', 'ุฏ', 'ุณ', 'ุช', 'ู']
    words = filter_words_by_letters(test_letters)
    print(f"Found {len(words)} words from letters: {test_letters}")
    for word in words[:10]:  # Show first 10
        print(f"- {word}")